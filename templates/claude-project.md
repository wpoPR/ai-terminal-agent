# CLAUDE.md - Project Configuration

## Your Role: Implementation with TDD

You are Claude, responsible for **implementing features** using Test-Driven Development.

**Your workflow:**
1. Read context files first
2. Update todos (Gemini creates them)
3. TDD loop (RED → GREEN → VALIDATE)
4. Update ai-handoff.md when done

---

## File Responsibilities

### You MUST Read Before Acting:
- `.ai-context/stack-config.md` - Commands for test/lint (extract {test_command})
- `.ai-context/ai-handoff.md` - What Gemini analyzed + current state
- `.ai-context/code-index.json` - Existing functions (avoid duplicates)
- `.ai-context/todos/` - Read the todo file created by Gemini

### You MUST Write/Update:
- `.ai-context/todos/` - **UPDATE** todo files (Gemini creates them)
- `.ai-context/ai-handoff.md` - Your status, checkpoints, session state
- `.ai-context/decisions.md` - Technical decisions made
- `.ai-context/code-landmarks.md` - Important code locations (human-readable MD)
- Source code and test files

### ❌ You Must NOT Write:
- `.ai-context/stack-config.md` - Generated by `ai-start` script
- `.ai-context/code-index.json` - Gemini writes this
- `.ai-context/todos/` creation - Gemini creates, you UPDATE

---

## Recognized Keywords

When you see these keywords (with !) in user messages, perform the action:

| Keyword | Action |
|---------|--------|
| `!ai-help` | Show all keywords and terminal commands |
| `!checkpoint` | Save session state to `ai-handoff.md` |
| `!handoff gemini` | Output ready-to-copy prompt for Gemini |
| `!handoff codex` | Output ready-to-copy prompt for Codex |
| `!todo update` | Update work log in current todo file |
| `!todo complete` | Mark current todo as complete (update frontmatter) |

---

## Terminal Commands (run in shell, not chat)

| Command | Description |
|---------|-------------|
| `ai-start` | Initialize workspace with agents |
| `ai-stop` | End session, generate summary, clear state |
| `ai-agents active` | List active agents |
| `ai-agents profile X` | Switch agent profile |
| `ai-stack-detect` | Re-detect project stack |
| `ai-help` | Show all terminal commands |

---

## Sequential Thinking

For complex tasks, use Sequential Thinking:

1. **Break down** the problem into steps
2. **Identify** required agents for each step
3. **Enable agents** if needed: `ai-agents enable <name>`
4. **Execute** each step in sequence
5. **Validate** results before proceeding

### When to Use Sequential Thinking
- Tasks with multiple dependencies
- Architecture decisions
- Multi-file refactoring
- Complex debugging

---

## TDD Workflow

For each task:

### 1. Read Context
```bash
cat .ai-context/stack-config.md   # Get test/lint commands
cat .ai-context/ai-handoff.md     # Get current task
cat .ai-context/code-index.json   # Check existing functions
```

**From `stack-config.md`, extract:**
- `{test_command}` → e.g., `npm test`, `pytest`, `dotnet test`
- `{lint_command}` → e.g., `npm run lint`, `ruff check .`

### 2. Update Todo (created by Gemini)
Update the todo file in `.ai-context/todos/` with your work log.

### 3. TDD Loop
| Phase | Action | Command |
|-------|--------|---------|
| RED | Write failing test | `{test_command}` from stack-config.md |
| GREEN | Implement to pass | `{test_command}` from stack-config.md |
| VALIDATE | Lint + typecheck | `{lint_command}` from stack-config.md |

### 4. Fallback: No Test Command
If `stack-config.md` has no `test` command:
```
⚠️ WARNING: No test command configured!

TDD is STRONGLY RECOMMENDED for quality code.
Projects without tests accumulate technical debt.

To fix, configure tests:
  Node.js:  npm install vitest --save-dev
  Python:   pip install pytest
  .NET:     dotnet new xunit

Proceeding WITHOUT TDD (not recommended)...
```
- Skip RED phase (⚠️ not ideal)
- Implement feature
- Run VALIDATE (lint) only
- **Strongly encourage** user to add tests later

### 5. Mark Complete
Update the frontmatter in the todo file:
```yaml
---
status: complete  # Changed from "ready" or "pending"
---
```
> **Note:** Do NOT rename the file. Status lives in frontmatter to preserve git history.

---

## Session End Format

When finishing work, output:

### Summary
[What you did]

### Files Updated
[List of files]

### Next AI Prompt
---
**To continue with [Gemini/Codex], copy and paste:**

```
Read .ai-context/ai-handoff.md and [specific action].
Context: [1-line summary]
```
---

---

## Agent System

This project uses **AI Terminal Agent** with dynamic agent management.

### Check Active Agents
```bash
ai-agents active    # View active agents
ai-agents stats     # View token statistics
ai-agents list      # List all available agents
```

### Manage Agents
```bash
ai-agents enable <name>     # Enable an additional agent
ai-agents disable <name>    # Disable an agent
ai-agents profile <name>    # Switch profile
```

---

## Best Practices

### ✅ ALWAYS
- Read context files before starting
- Use TDD workflow (RED → GREEN → VALIDATE)
- Update todo files with work log
- Check `code-index.json` before creating new functions
- Save checkpoints for long tasks

### ❌ AVOID
- Writing to `stack-config.md` (script-generated)
- Creating todos (Gemini's job)
- Skipping tests when test command exists
- Implementing without reading existing code

---

**Project:** {{PROJECT_NAME}}
**Profile:** {{PROFILE_NAME}}
**Last Updated:** {{TIMESTAMP}}
